<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<title>RIPPING THE LID OFF &vert; PYNQER</title>
<meta name="description" content="To work with PYNQ in an unskilled or experimental manner.">
<meta name="keywords" content="">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://devbisme.github.io/pynqer/docs/_site/images/logo.png">
<meta name="twitter:title" content="Ripping the Lid Off">
<meta name="twitter:description" content="To work with PYNQ in an unskilled or experimental manner.">
<meta name="twitter:creator" content="@devbisme">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Ripping the Lid Off">
<meta property="og:description" content="To work with PYNQ in an unskilled or experimental manner.">
<meta property="og:url" content="https://devbisme.github.io/pynqer/docs/_site/blog/ripping-the-lid-off">
<meta property="og:site_name" content="PYNQer">
<meta property="og:image" content="https://devbisme.github.io/pynqer/docs/_site/images/">





<link rel="canonical" href="https://devbisme.github.io/pynqer/docs/_site/blog/ripping-the-lid-off">
<link href="https://devbisme.github.io/pynqer/docs/_site/feed.xml" type="application/atom+xml" rel="alternate" title="PYNQer Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />


    <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700|Open+Sans:400,600,300,800,700' rel='stylesheet' type='text/css'>
	<!-- <link rel="stylesheet" href="https://devbisme.github.io/pynqer/docs/_site/assets/css/vendor/font-awesome.min.css"> -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://devbisme.github.io/pynqer/docs/_site/assets/css/vendor/normalize.css">
    <link rel="stylesheet" href="https://devbisme.github.io/pynqer/docs/_site/assets/css/vendor/nprogress.css">
    <link rel="stylesheet" href="https://devbisme.github.io/pynqer/docs/_site/assets/css/vendor/foundation.min.css">
    <link rel="stylesheet" href="https://devbisme.github.io/pynqer/docs/_site/assets/css/style.css">
    <link rel="stylesheet" href="https://devbisme.github.io/pynqer/docs/_site/assets/css/post.css">



<!--Load Mathjax-->
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script>
        MathJax.Hub.Config({
            config: ["MMLorHTML.js"],
            extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js"],
            jax: ["input/TeX"],
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                processEscapes: false
            },
            TeX: {
                TagSide: "right",
                TagIndent: ".8em",
                MultLineWidth: "85%",
                equationNumbers: {
                   autoNumber: "AMS",
                },
                unicode: {
                   fonts: "STIXGeneral,'Arial Unicode MS'" 
                }
            },
            showProcessingMessages: false
        });
    </script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://devbisme.github.io/pynqer/docs/_site/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://devbisme.github.io/pynqer/docs/_site/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://devbisme.github.io/pynqer/docs/_site/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://devbisme.github.io/pynqer/docs/_site/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://devbisme.github.io/pynqer/docs/_site/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://devbisme.github.io/pynqer/docs/_site/images/apple-touch-icon-144x144-precomposed.png">

        
            <style type="text/css">@media only screen and (min-width:43.75em){.notepad-post-content div>p:first-child:first-letter{float:left;font-size:4.688rem;line-height:4.375rem;padding-top:.25rem;padding-right:.5rem;padding-left:.188rem;font-family:serif}}</style>
        
    </head>
    <body class="post-template" itemscope itemtype="http://schema.org/WebPage">
        
            <main id="notepad-post-container-simple" class="notepad-post-container-simple" role="main">
                <header class="notepad-post-header-simple">
                    <div class="notepad-post-menu-header-simple">
                        
                        <a class="notepad-blog-logo" href="https://devbisme.github.io/pynqer/docs/_site">
                        <img src="https://devbisme.github.io/pynqer/docs/_site/images/logo.png" alt="Blog Logo" />
                        </a>
                        <div class="notepad-blog-menu">
                            <div class="notepad-mobile-menu show-for-small">
                                <a href="#"><i class="fa fa-bars"></i></a>
                            </div>
                            <ul class="notepad-menu">
                                <li class="notepad-mobile-close-btn show-for-small text-right">
                                    <a href="#"><i class="fa fa-times"></i></a>
                                </li>
                                
                                <li>
                                    <a href="https://devbisme.github.io/pynqer/docs/_site/">Home</a>
                                     
                                </li>
                                
                                <li>
                                    <a href="https://devbisme.github.io/pynqer/docs/_site/blog">Blog</a>
                                     
                                </li>
                                
                                <li>
                                    <a href="http://github.com/devbisme/PYNQer">Github</a>
                                     
                                </li>
                                
                                <li>
                                    <a href="https://devbisme.github.io/pynqer/docs/_site/about">About</a>
                                     
                                </li>
                                            
                                <li><a href="https://devbisme.github.io/pynqer/docs/_site/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
                            </ul>
                        </div>
                    </div>
                    
                <div class="notepad-post-title-simple row">
                    <div class="small-12 columns">
                        <div class="notepad-post-meta-simple">
                            <h1>Ripping the Lid Off</h1>
                            <p>
                                by <strong>Dave Vandenbout</strong> &#8212; 
                                
                                
                                <strong><time datetime="2017-05-14T18:08:27-04:00">14 May 2017</time></strong>
                            </p>
                            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                            <!-- codein1 -->
                            <ins class="adsbygoogle"
                                style="display:inline-block;width:728px;height:90px"
                                data-ad-client="ca-pub-7466474470517357"
                                data-ad-slot="6700962438"></ins>
                            <script>
                                (adsbygoogle = window.adsbygoogle || []).push({});
                            </script>
                        </div>
                    </div>
                </div>
        </header>
        
        
            <article class="notepad-post-content post tag-simple">
        
        <div><p>The obvious place to start exploring PYNQ is to play with its buttons and LEDs.
There’s already a <a href="https://github.com/Xilinx/PYNQ/blob/master/Pynq-Z1/notebooks/examples/board_btns_leds.ipynb">notebook</a>
for that so there’s no need for me to replicate it.
A more interesting question is what’s going on underneath?
So I’m going to rip the lid off the PYNQ software and start examining its innards.</p>

<p>A good starting point is the <code class="highlighter-rouge">pynq</code> package:</p>

<div class="cell">
	<div class="prompt input-prompt">
	
		In
        
	[1]:</div>
	
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pynq</span></code></pre></figure>

</div>

<p>You can find the source here:</p>

<div class="cell">
	<div class="prompt input-prompt">
	
		In
        
	[2]:</div>
	
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">pynq</span><span class="o">.</span><span class="n">__path__</span></code></pre></figure>

</div>

<div class="cell">
	<div class="prompt output-prompt">
	
		Out
        
	[2]:</div>
	
<figure class="highlight"><pre><code class="language-text" data-lang="text">['/opt/python3.6/lib/python3.6/site-packages/pynq']</code></pre></figure>

</div>

<p>The <code class="highlighter-rouge">Overlay</code> class in the <code class="highlighter-rouge">pynq</code> package lets you specify a particular overlay that will be loaded into the Programmable Logic (PL) section of the ZYNQ chip.
Xilinx has already provided a pre-compiled overlay that interfaces to the PYNQ’s buttons and LEDs (and other things):</p>

<div class="cell">
	<div class="prompt input-prompt">
	
		In
        
	[3]:</div>
	
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">base</span> <span class="o">=</span> <span class="n">pynq</span><span class="o">.</span><span class="n">Overlay</span><span class="p">(</span><span class="s">'base.bit'</span><span class="p">)</span></code></pre></figure>

</div>

<p>This reads in the bitstream for the overlay, but doesn’t yet load it into the PL.
Let’s see what’s in it:</p>

<div class="cell">
	<div class="prompt input-prompt">
	
		In
        
	[4]:</div>
	
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nb">dir</span><span class="p">(</span><span class="n">base</span><span class="p">)</span></code></pre></figure>

</div>

<div class="cell">
	<div class="prompt output-prompt">
	
		Out
        
	[4]:</div>
	
<figure class="highlight"><pre><code class="language-text" data-lang="text">['__class__',
 '__delattr__',
 '__dict__',
 '__dir__',
 '__doc__',
 '__eq__',
 '__format__',
 '__ge__',
 '__getattribute__',
 '__gt__',
 '__hash__',
 '__init__',
 '__init_subclass__',
 '__le__',
 '__lt__',
 '__module__',
 '__ne__',
 '__new__',
 '__reduce__',
 '__reduce_ex__',
 '__repr__',
 '__setattr__',
 '__sizeof__',
 '__str__',
 '__subclasshook__',
 '__weakref__',
 '_bitfile_name',
 '_gpio_dict',
 '_host',
 '_interrupt_controllers',
 '_interrupt_pins',
 '_ip_dict',
 '_remote',
 '_server',
 '_timestamp',
 'bitfile_name',
 'bitstream',
 'client_request',
 'download',
 'gpio_dict',
 'interrupt_controllers',
 'interrupt_pins',
 'ip_dict',
 'is_loaded',
 'load_ip_data',
 'reset',
 'server_update',
 'setup']</code></pre></figure>

</div>

<p>From this, the actual location of the overlay bitstream is easily found:</p>

<div class="cell">
	<div class="prompt input-prompt">
	
		In
        
	[5]:</div>
	
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">base</span><span class="o">.</span><span class="n">bitfile_name</span></code></pre></figure>

</div>

<div class="cell">
	<div class="prompt output-prompt">
	
		Out
        
	[5]:</div>
	
<figure class="highlight"><pre><code class="language-text" data-lang="text">'/opt/python3.6/lib/python3.6/site-packages/pynq/bitstream/base.bit'</code></pre></figure>

</div>

<p>If you look in that directory, you’ll also see a file called <code class="highlighter-rouge">base.tcl</code>.
This contains <em>a lot</em> of information about the interface between the 
PL and the Processing System (PS) where the PYNQ Python code runs.
One of the things the <code class="highlighter-rouge">Overlay</code> class does is search through this
file, looking up all the interface information, and loading the
necessary bits into dictionaries in the object it creates.</p>

<p>You would <em>think</em> the <code class="highlighter-rouge">gpio_dict</code> contains the information about accessing
the LEDs and buttons on the PYNQ board. Let’s see:</p>

<div class="cell">
	<div class="prompt input-prompt">
	
		In
        
	[6]:</div>
	
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">base</span><span class="o">.</span><span class="n">gpio_dict</span></code></pre></figure>

</div>

<div class="cell">
	<div class="prompt output-prompt">
	
		Out
        
	[6]:</div>
	
<figure class="highlight"><pre><code class="language-text" data-lang="text">{'audio_path_sel': [3, None],
 'mb_1_intr_ack': [4, None],
 'mb_1_reset': [0, None],
 'mb_2_intr_ack': [5, None],
 'mb_2_reset': [1, None],
 'mb_3_intr_ack': [6, None],
 'mb_3_reset': [2, None]}</code></pre></figure>

</div>

<p>Hmm, not quite what was expected.
Looks like the reset and interrupt acknowledge pins are here, but nothing else.
So the buttons and LEDs don’t have direct connections from the PL to the PS.
Let’s try <code class="highlighter-rouge">ip_dict</code>:</p>

<div class="cell">
	<div class="prompt input-prompt">
	
		In
        
	[7]:</div>
	
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">base</span><span class="o">.</span><span class="n">ip_dict</span></code></pre></figure>

</div>

<div class="cell">
	<div class="prompt output-prompt">
	
		Out
        
	[7]:</div>
	
<figure class="highlight"><pre><code class="language-text" data-lang="text">{'SEG_axi_dma_0_Reg': [2151677952, 65536, None],
 'SEG_axi_dma_0_Reg1': [2151743488, 65536, None],
 'SEG_axi_dynclk_0_reg0': [1136721920, 65536, None],
 'SEG_axi_gpio_video_Reg': [1092747264, 65536, None],
 'SEG_axi_vdma_0_Reg': [1124073472, 65536, None],
 'SEG_btns_gpio_Reg': [1092681728, 65536, None],
 'SEG_d_axi_pdm_1_S_AXI_reg': [1136656384, 65536, None],
 'SEG_hdmi_out_hpd_video_Reg': [1092812800, 65536, None],
 'SEG_mb_bram_ctrl_1_Mem0': [1073741824, 65536, None],
 'SEG_mb_bram_ctrl_2_Mem0': [1107296256, 65536, None],
 'SEG_mb_bram_ctrl_3_Mem0': [1140850688, 65536, None],
 'SEG_rgbled_gpio_Reg': [1092878336, 65536, None],
 'SEG_swsleds_gpio_Reg': [1092616192, 65536, None],
 'SEG_system_interrupts_Reg': [1098907648, 65536, None],
 'SEG_trace_cntrl_0_Reg': [2210398208, 65536, None],
 'SEG_trace_cntrl_0_Reg2': [2210463744, 65536, None],
 'SEG_v_tc_0_Reg': [1136787456, 65536, None],
 'SEG_v_tc_1_Reg': [1136852992, 65536, None]}</code></pre></figure>

</div>

<p>This is more helpful. There are entries that look related to the buttons (<code class="highlighter-rouge">SEG_btns_gpio_Reg</code>), 
LEDs (<code class="highlighter-rouge">SEG_swsleds_gpio_Reg</code>), and RGB LEDs (<code class="highlighter-rouge">SEG_rgbled_gpio_Reg</code>).
But what do the entries mean?</p>

<p>Typing:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>help(base)
</code></pre></div></div>

<p>provides some information about that (along with quite a bit of other stuff):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Each entry of the IP dictionary is a mapping:
 |  'name' -&gt; [address, range, state]
 |  
 |  where
 |  name (str) is the key of the entry.
 |  address (int) is the base address of the IP.
 |  range (int) is the address range of the IP.
 |  state (str) is the state information about the IP.
</code></pre></div></div>

<p>This implies that reading the buttons or driving the LEDs is done using a read or write
to a location within a bank of memory addresses.
So the Python code for the buttons and LEDs must contain the instructions for what
particular address offsets and bit locations are used.</p>

<p>The <a href="https://github.com/Xilinx/PYNQ/blob/master/python/pynq/board/button.py">Python code for the buttons</a> is stored in:</p>

<div class="cell">
	<div class="prompt input-prompt">
	
		In
        
	[8]:</div>
	
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pynq.board.button</span>
<span class="n">pynq</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">__file__</span></code></pre></figure>

</div>

<div class="cell">
	<div class="prompt output-prompt">
	
		Out
        
	[8]:</div>
	
<figure class="highlight"><pre><code class="language-text" data-lang="text">'/opt/python3.6/lib/python3.6/site-packages/pynq/board/button.py'</code></pre></figure>

</div>

<p>There are two important imports in there:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from pynq import MMIO
from pynq import PL
</code></pre></div></div>

<p>The <code class="highlighter-rouge">MMIO</code> class instantiates objects for reading and writing to a segment of memory, and
the <code class="highlighter-rouge">PL</code> is a singleton object that provides access to the dictionaries of whatever overlay is currently
loaded into the PL of the ZYNQ.
The <code class="highlighter-rouge">__init__</code> method of a <code class="highlighter-rouge">Button</code> object uses
the <code class="highlighter-rouge">ip_dict</code> of the <code class="highlighter-rouge">Overlay</code> object to initialize an <code class="highlighter-rouge">MMIO</code> object with the starting
address and size of the address range for the buttons:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def __init__(self, index):
        if Button._mmio is None:
            Button._mmio = MMIO(PL.ip_dict["SEG_btns_gpio_Reg"][0], 512)
        self.index = index  # This is the bit position of a button in the memory word.
        ...
</code></pre></div></div>

<p>Then the <code class="highlighter-rouge">Button</code> object’s <code class="highlighter-rouge">read</code> method will return a
particular button’s current state by reading the memory word and masking-off the associated bit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def read(self):
    curr_val = Button._mmio.read()  # Read the 1st word of the memory range.
    return (curr_val &amp; (1 &lt;&lt; self.index)) &gt;&gt; self.index  # Mask off the bit for this button.
</code></pre></div></div>

<p>The <a href="https://github.com/Xilinx/PYNQ/blob/master/python/pynq/board/led.py">Python code for the LED</a>
is very similar except that it writes a bit to the memory address to turn an LED on or off.
(Except that the address for writing the LED values is offset by <code class="highlighter-rouge">0x8</code> for some unknown reason
that may become apparent later.)</p>

<p>So, if I understand this correctly, I should be able to explicitly use <code class="highlighter-rouge">MMIO</code> and <code class="highlighter-rouge">PL</code> to write my own
code for reading the state of a buttons and turning the LEDs on or off.
The code in the following cell can be run and then (for a 10-second interval)
the LED above each button on the PYNQ-Z1 will come on as long as that button is pushed.</p>

<div class="cell">
	<div class="prompt input-prompt">
	
		In
        
	[9]:</div>
	
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pynq</span> <span class="kn">import</span> <span class="n">Overlay</span><span class="p">,</span> <span class="n">PL</span><span class="p">,</span> <span class="n">MMIO</span>

<span class="n">base</span> <span class="o">=</span> <span class="n">Overlay</span><span class="p">(</span><span class="s">'base.bit'</span><span class="p">)</span>
<span class="n">base</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>             <span class="c1"># Load the PL of the ZYNQ with the bitstream for buttons &amp; LEDs.
</span>
<span class="c1"># Create MMIO objects for reading the buttons and turning the LEDs on and off.
</span><span class="n">button_addr</span>  <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">ip_dict</span><span class="p">[</span><span class="s">'SEG_btns_gpio_Reg'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">button_range</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">ip_dict</span><span class="p">[</span><span class="s">'SEG_btns_gpio_Reg'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">button_mmio</span>  <span class="o">=</span> <span class="n">MMIO</span><span class="p">(</span><span class="n">button_addr</span><span class="p">,</span> <span class="n">button_range</span><span class="p">)</span>
<span class="n">led_addr</span>     <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">ip_dict</span><span class="p">[</span><span class="s">'SEG_swsleds_gpio_Reg'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">led_range</span>    <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">ip_dict</span><span class="p">[</span><span class="s">'SEG_swsleds_gpio_Reg'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">led_mmio</span>     <span class="o">=</span> <span class="n">MMIO</span><span class="p">(</span><span class="n">led_addr</span><span class="p">,</span> <span class="n">led_range</span><span class="p">)</span>

<span class="c1"># For a ten-second interval, read the values of all four buttons and
# display it on all four of the LEDs.
</span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mf">10.0</span>
<span class="k">while</span> <span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
    <span class="n">buttons</span> <span class="o">=</span> <span class="n">button_mmio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Read memory word containing all four button values.
</span>    <span class="n">led_mmio</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mh">0x8</span><span class="p">,</span> <span class="n">buttons</span><span class="p">)</span>   <span class="c1"># Write button values to memory word driving all four LEDs.</span></code></pre></figure>

</div>

<p>The same thing can be done using the higher-level PYNQ software:</p>

<div class="cell">
	<div class="prompt input-prompt">
	
		In
        
	[10]:</div>
	
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pynq</span> <span class="kn">import</span> <span class="n">Overlay</span>
<span class="kn">from</span> <span class="nn">pynq.board.button</span> <span class="kn">import</span> <span class="n">Button</span>
<span class="kn">from</span> <span class="nn">pynq.board.led</span> <span class="kn">import</span> <span class="n">LED</span>

<span class="c1"># Create lists of the buttons and LEDs.
</span><span class="n">buttons</span> <span class="o">=</span> <span class="p">[</span><span class="n">Button</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">leds</span> <span class="o">=</span> <span class="p">[</span><span class="n">LED</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>

<span class="c1"># For a ten-second interval, execute a loop to read the values of each button and
# display it on the associated LED.
</span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mf">10.0</span>
<span class="k">while</span> <span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">leds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">buttons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="p">)</span>
        </code></pre></figure>

</div>

<p>Obviously, using the higher-level constructs makes the intent of the code clearer, so
why bother with the low-level, explicit approach?
<em>Because it shows how the magic is done!</em>
And I’ll need to recreate that magic when I build my own PL overlays and interface them to the PS.
An understanding of the underlying code is necessary for that.</p>

<p>You’ll notice in <code class="highlighter-rouge">button.py</code> that it includes some code for handling interrupts.
I’ll start tinkering with those next.</p>

<h2 id="pertinent-files">Pertinent Files</h2>

<p>Here is a list of the files I examined while making this blog post:</p>

<ul>
  <li><a href="https://github.com/Xilinx/PYNQ/blob/master/Pynq-Z1/bitstream/base.bit"><code class="highlighter-rouge">base.bit</code></a>: 
A bitstream that program the ZYNQ’s PL with a set of interfaces to the hardware on the PYNQ-Z1 board.</li>
  <li><a href="https://github.com/Xilinx/PYNQ/blob/master/Pynq-Z1/bitstream/base.tcl"><code class="highlighter-rouge">base.tcl</code></a>: 
Contains a set of definitions for register/memory addresses for the interfaces in the <code class="highlighter-rouge">base</code> overlay.</li>
  <li><a href="https://github.com/Xilinx/PYNQ/blob/master/python/pynq/pl.py"><code class="highlighter-rouge">pl.py</code></a>: 
Defines the classes for PL overlays (<code class="highlighter-rouge">PL_Meta</code>, <code class="highlighter-rouge">PL</code>, <code class="highlighter-rouge">Bitstream</code> and <code class="highlighter-rouge">Overlay</code>).</li>
  <li><a href="https://github.com/Xilinx/PYNQ/blob/master/python/pynq/mmio.py"><code class="highlighter-rouge">mmio.py</code></a>: 
Defines the <code class="highlighter-rouge">MMIO</code> class for reading/writing a segment of memory.</li>
  <li><a href="https://github.com/Xilinx/PYNQ/blob/master/python/pynq/board/button.py"><code class="highlighter-rouge">button.py</code></a>: 
Defines the <code class="highlighter-rouge">Button</code> class for reading the state of the pushbuttons on the PYNQ-Z1.</li>
  <li><a href="https://github.com/Xilinx/PYNQ/blob/master/python/pynq/board/switch.py"><code class="highlighter-rouge">switch.py</code></a>: 
Defines the <code class="highlighter-rouge">Switch</code> class for reading the state of the slide switches on the PYNQ-Z1.
(I didn’t use these in this post.)</li>
  <li><a href="https://github.com/Xilinx/PYNQ/blob/master/python/pynq/board/led.py"><code class="highlighter-rouge">led.py</code></a>: 
Defines the <code class="highlighter-rouge">LED</code> class for changing the state of ON-OFF LEDs on the PYNQ-Z1.</li>
  <li><a href="https://github.com/Xilinx/PYNQ/blob/master/python/pynq/board/rgbled.py"><code class="highlighter-rouge">rgbled.py</code></a>: 
Defines the <code class="highlighter-rouge">RGBLED</code> class for changing the state of RGB LEDs on the PYNQ-Z1.
(I didn’t use these in this post.)</li>
  <li><a href="https://github.com/xesscorp/pynqer/tree/master/Notebooks/ripping_the_lid_off.ipynb">This Jupyter notebook</a>:
Contains the executable notebook from which this post was generated.</li>
</ul>


        </div>
        <div style="text-align: center;">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <!-- codein2-footer -->
<!--
        <ins class="adsbygoogle"
            style="display:inline-block;width:728px;height:90px"
            data-ad-client="ca-pub-7466474470517357"
            data-ad-slot="9952356430"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
-->
        </div>
        </article>
        <div class="cf"></div>
                <div class="row text-center">
            <section class="notepad-post-share">
                <a class="twitter-icon" href="https://twitter.com/intent/tweet?text=&quot;Ripping the Lid Off&quot;%20https://devbisme.github.io/pynqer/docs/_site/blog/ripping-the-lid-off%20via%20&#64;devbisme"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="facebook-icon" href="https://www.facebook.com/sharer/sharer.php?u=https://devbisme.github.io/pynqer/docs/_site/blog/ripping-the-lid-off"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="google-icon" href="https://plus.google.com/share?url=https://devbisme.github.io/pynqer/docs/_site/blog/ripping-the-lid-off"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google+">
                    <i class="fa fa-google-plus"></i>
                </a>
            </section>
        </div>
        <div class="cf"></div>
                    <div class="notepad-author-info">
                <div class="row">
                    <section class="notepad-post-author small-12 columns">
                        <img src="https://devbisme.github.io/pynqer/docs/_site/images/devb-pic.jpg" class="notepad-post-author-avatar" alt="Dave Vandenbout's photo">
                        <span class="author-label">Author:</span>
                        <h1>Dave Vandenbout</h1>
                        <p><a href="mailto:devb@xess.com" class="author-website">devb@xess.com</a>
                        <p>Relax, I do this stuff for a living.</p>
                    </section>
                </div>
            </div>
 
        <div class="cf"></div>
        
        <div class="cf"></div>
        <footer class="notepad-site-footer">
    <div class="copyright">
        <section>
            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
                <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
            </a>
            <br /><br />
            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">PYNQer website</span> by 
            <a xmlns:cc="http://creativecommons.org/ns#" href="www.xess.com" property="cc:attributionName" rel="cc:attributionURL">
                XESS Corporation
            </a> 
            is licensed under a 
            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
                Creative Commons Attribution 4.0 International License
            </a>.
        </section>
        <br />
        <p>
            <a href='http://www.catb.org/hacker-emblem/' target="_blank"><img src='https://devbisme.github.io/pynqer/docs/_site/assets/img/hacker.png' alt='hacker emblem' /></a>
            <a href="http://endsoftpatents.org/innovating-without-patents" target="_blank"><img style="border-width:0" src="https://devbisme.github.io/pynqer/docs/_site/assets/img/patent-free.png"></a>
        </p>
    </div>
    <div class="social-icons">
        
        
        <a href="http://twitter.com/devbisme">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-twitter fa-stack-1x"></i>
            </span>
        </a>
        
        
        
        
        <a href="http://github.com/devbisme">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-github fa-stack-1x"></i>
            </span>
        </a>
        
        
    </div>
    
    <div class="cf"></div>
</footer>
 
        </main>    
            <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="https://devbisme.github.io/pynqer/docs/_site/assets/js/vendor/jquery-1.11.1.min.js"><\/script>')</script>
    <script src="https://devbisme.github.io/pynqer/docs/_site/assets/js/vendor/modernizr.js"></script>
    <script src="https://devbisme.github.io/pynqer/docs/_site/assets/js/foundation.min.js"></script>
    
    <script src="https://devbisme.github.io/pynqer/docs/_site/assets/js/notepad.js"></script>
    <script src="https://devbisme.github.io/pynqer/docs/_site/assets/js/scripts.min.js"></script>
    <script src="https://devbisme.github.io/pynqer/docs/_site/assets/js/vendor/nprogress.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/sigma.js/1.0.3/sigma.min.js"></script>

    <script>
      $(document).foundation();
    </script>


<script>NProgress.start();var interval=setInterval(function(){NProgress.inc()},1000);jQuery(window).load(function(){clearInterval(interval);NProgress.done()});jQuery(window).unload(function(){NProgress.start()});</script>
 
    </body>
</html>